<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mk3-prog-cli: Mojo-NES MK3 programmer Command Line Interface</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mk3-prog-cli
   </div>
   <div id="projectbrief">Awesome mojo-nes-mk3 programmer command line interface</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Mojo-NES MK3 programmer Command Line Interface </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Command Line Interface for the Awesome Mojo-NES MKIII programmer.</p>
<p>This utility allows to manage mojo-nes-mk3 cartridges, using a mojo-nes-mk3 programmer. The utility allows to program and read flash and RAM chips. A driver system allows to support several mapper chip implementations.</p>
<h1>Building</h1>
<p>You will need a working GNU GCC compiler and an Awesome Mojo-NES MKIII programmer to burn the ROM to a Mojo-NES MKIII cartridge. You will also need to install <code>libftdi</code>, <code>libmpsse</code> and <code>glib</code> libraries, including development headers. If you are a Linux user, you most likely have <code>glib</code> installed (it is a common Gnome library), and can install <code>libftdi</code> from your distro repositories. If your distro does not come with <code>libmpsse</code>, you can grab it from <a href="https://github.com/devttys0/libmpsse">here</a>. Note this is <em>not</em> the privative library available from FTDI, but an open source alternative.</p>
<p>If you are planning to program the CIC chip inside the cartridge, or to update the programmer firmware, you will also need to install <code>avrdude</code>. And if you are planning to program the FPGA inside the cartridge, you will have to install <a href="http://www.latticesemi.com/latticediamond">Lattice Diamond</a> or <a href="http://www.latticesemi.com/en/Products/DesignSoftwareAndIP/ProgrammingAndConfigurationSw/Programmer.aspx">Lattice Programmer</a>.</p>
<p>Once you have your development environment properly installed, <code>make</code> should do all the hard work for you. Just browse the <code>Makefile</code> to suit it to your dev environment. Then build and install the program: </p><div class="fragment"><div class="line">$ make</div><div class="line">$ sudo make install</div></div><!-- fragment --><p> The mk3-prog program should be installed in your system, along with the configuration files.</p>
<h1>Usage</h1>
<p>Once you have plugged a Mojo-NES MKIII cartridge into an Awesome Mojo-NES MKIII Programmer, you can use mk3-prog to burn some ROMs. Please have in mind that currently the programmer does not support .nes files. You will have to extract the CHR and PRG ROMs from them, using a tool such as <a href="https://github.com/AaronBottegal/ReadNES3">ReadNES3</a>.</p>
<h2>Command line invocation</h2>
<p>The command line application invocation must be as follows: </p><div class="fragment"><div class="line">$ mk3-prog [option1 [option1_arg]] […] [optionN [optionN_arg]]</div></div><!-- fragment --><p> The options (option1 ~ optionN) can be any combination of the ones listed below. Options must support short and long formats. Depending on the used option, and option argument (option_arg) must be supplied. Several options can be used on the same command, as long as the combination makes sense (e.g. it does make sense using the flash and verify options together, but using the help option with the flash option doesn't make too much sense).</p>
<table class="doxtable">
<tr>
<th>Option </th><th>Description  </th></tr>
<tr>
<td>-f, &ndash;firm-ver </td><td>Get programmer firmware version </td></tr>
<tr>
<td>-c, &ndash;flash-chr &lt;arg&gt; </td><td>Flash file to CHR ROM </td></tr>
<tr>
<td>-p, &ndash;flash-prg &lt;arg&gt; </td><td>Flash file to PRG ROM </td></tr>
<tr>
<td>-C, &ndash;read-chr &lt;arg&gt; </td><td>Read CHR ROM to file </td></tr>
<tr>
<td>-P, &ndash;read-prg &lt;arg&gt; </td><td>Read PRG ROM to file </td></tr>
<tr>
<td>-e, &ndash;erase-chr </td><td>Erase CHR Flash </td></tr>
<tr>
<td>-E, &ndash;erase-prg </td><td>Erase PRG Flash </td></tr>
<tr>
<td>-s, &ndash;chr-sec-er &lt;arg&gt; </td><td>Erase CHR flash sector </td></tr>
<tr>
<td>-S, &ndash;prg-sec-er &lt;arg&gt; </td><td>Erase PRG flash sector </td></tr>
<tr>
<td>-V, &ndash;verify </td><td>Verify flash after writing file </td></tr>
<tr>
<td>-i, &ndash;flash-id </td><td>Obtain flash chips identifiers </td></tr>
<tr>
<td>-R, &ndash;read-ram &lt;arg&gt; </td><td>Read data from RAM chip </td></tr>
<tr>
<td>-W, &ndash;write-ram &lt;arg&gt; </td><td>Write data to RAM chip </td></tr>
<tr>
<td>-b, &ndash;fpga-flash &lt;arg&gt; </td><td>Upload bitfile to FPGA, using .xcf file </td></tr>
<tr>
<td>-a, &ndash;cic-flash &lt;arg&gt; </td><td>AVR CIC firmware flash </td></tr>
<tr>
<td>-F, &ndash;firm-flash &lt;arg&gt; </td><td>Flash programmer firmware </td></tr>
<tr>
<td>-m, &ndash;mpsse-if &lt;arg&gt; </td><td>Set MPSSE interface number </td></tr>
<tr>
<td>-M, &ndash;mapper &lt;arg&gt; </td><td>Set mapper: 1-NOROM, 2-MMC3, 3-NFROM </td></tr>
<tr>
<td>-d, &ndash;dry-run </td><td>Dry run: don't actually do anything </td></tr>
<tr>
<td>-r, &ndash;version </td><td>Show program version </td></tr>
<tr>
<td>-v, &ndash;verbose </td><td>Show additional information </td></tr>
<tr>
<td>-h, &ndash;help </td><td>Print help screen and exit </td></tr>
</table>
<p>The &lt;arg&gt; text indicates that the option takes an input argument. For the options requiring an argument that represents a memory image file, or a memory address, the syntax is as follows:</p><ul>
<li>Memory image file: file_name[:start_addr[:length]]. Along with the file name, optional address and length fields can be added, separated by the colon (:) character, resulting in the following format:</li>
<li>Address: Specifies an address related to the command (e.g. the address to which to flash a cartridge ROM or WiFi firmware blob).</li>
</ul>
<p>Some examples of the command invocation and its arguments are:</p><ul>
<li><code>$ mk3-prog -VeEc chr_rom_file -p prg_rom_file</code> → Erases entire cartridge (both CHR and PRG flash chips), flashes chr_rom_file to CHR flash, prg_rom_file to PRG flash, and verifies the writes.</li>
<li><code>$ mk3-prog --erase_chr -c chr_rom_file:0x1000</code> → Erases entire CHR flash chip and flashes contents of chr_rom_file to CHR flash, starting at address 0x1000.</li>
<li><code>$ mk3-prog -S 0x10000</code> → Erases PRG flash sector containing 0x100000 address.</li>
<li><code>$ mk3-prog -Vp prg_rom_file:0x10000:32768</code> → Flashes 32 KiB of prg_rom_file to address 0x10000, and verifies the operation.</li>
<li><code>$ mk3-prog --read_chr chr_rom_file::1048576</code> → Reads 1 MiB of the CHR flash chip, and writes it to chr_rom_file. Note that if you want to specify length but do not want to specify address, you have to use two colon characters before length. This way, missing address argument is interpreted as 0.</li>
</ul>
<h2>Configuration file customization</h2>
<p>This tool reads a config file, installed at <code>/etc/mk3-prog.cfg</code>, to extract some parameters, such as the install location of tools like e.g. avrdude. The configuration file is reproduced below, with a comment documenting each parameter. Most likely the only ones that need to be modified are the ones dealing with paths:</p>
<div class="fragment"><div class="line"># Default Awesome Mojo-NES MKIII programmer configuration</div><div class="line"></div><div class="line">[MPSSE]</div><div class="line"># Default MPSSE interface number</div><div class="line">ifnum = 2</div><div class="line"></div><div class="line">[LATTICE_PROGRAMMER]</div><div class="line"># Path of the lattice programmer tool</div><div class="line">path = /usr/local/diamond/3.7_x64/bin/lin64/pgrcmd</div><div class="line"></div><div class="line"></div><div class="line">[AVRDUDE]</div><div class="line"># Path of the avrdude tool</div><div class="line">path = /usr/bin/avrdude</div><div class="line"># Avrdude configuration file containing the MCU and CIC configurations</div><div class="line">conf = /usr/share/mk3-prog/mk3prog.conf</div><div class="line"># Programmer microcontroller definition</div><div class="line">chip_mcu = m8515</div><div class="line"># Configuration for flashing the programmer MCU</div><div class="line">prog_mcu = mk3prog-mcu</div><div class="line"># CIC microcontroller definition</div><div class="line">chip_cic = t13</div><div class="line"># Configuration for flashing the cartridge CIC</div><div class="line">prog_cic = mk3prog-cic</div></div><!-- fragment --><h1>Authors</h1>
<p>This program has been written by doragasu. You can find me on Twitter at @doragasu.</p>
<h1>Contributions</h1>
<p>Contributions are welcome. If you find a bug please open an issue, and if you have implemented a cool feature/improvement, please send a pull request.</p>
<h1>License</h1>
<p>This program is provided with NO WARRANTY, under the <a href="https://www.gnu.org/licenses/gpl-3.0.html">GPLv3 license</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
